{% extends "layout.html" %}

{% block page_content %}

<!-- Right side column. Contains the navbar and content of the page -->
<aside class="right-side">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            团练中心
        </h1>
        <ol class="breadcrumb">
            <li><a href="{{ url_for('main.index') }}"><i class="fa fa-dashboard"></i> Home</a></li>
            <li class="active"><a href="{{ url_for('team.index') }}">团练中心</a></li>
        </ol>
    </section>

    <!-- Main content -->
    <section class="content">
        <div class="row">
            <div class="col-md-12">
                <div class="box">

                    <div class="box-body">

                        <div class="box-header">
                            <h3 class="box-title">团练列表</h3>
                            
                        </div><!-- /.box-header -->

                        <table class="table table-bordered table-hover">
                            <tr>
                                <th>日期</th>
                                <th>区服</th>
                                <th>编号</th>
                                <th>目标</th>
                                <th>进度</th>
                                <th>状态</th>
                                <th style="width: 200px">操作</th>
                            </tr>
                            {% for team in teams %}
                            <tr>
                                <td>
                                    {{ team.name }}
                                    <input type="hidden" class="team-id" value="{{ team.id }}">
                                </td>
                                <td>{{ team.area.name}}</td>
                                <td>{{ team.no}}</td>
                                <td>{{ team.target}}</td>
                                <td>{{ team.now_level}}</td>
                                <td>{{ team.status.name }}</td>                                
                                <td>       
                                    <button type="button" class="btn btn-default view-team">
                                        <i class='fa fa-eye'></i>
                                    </button>
                                    {% if team.status.id == 3 %}
                                    <button type="button" class="btn btn-default start-team">
                                        <i class='fa fa-play'></i>
                                    </button>
                                    {% endif %}

                                    {% if team.status.id == 4 %}
                                    <button type="button" class="btn btn-default stop-team">
                                        <i class='fa fa-stop'></i>
                                    </button>
                                    {% endif %}

                                    
                                </td>
                            </tr>
                            {% endfor %}
                        </table>
                    </div><!-- /.box-body -->
                </div>
            </div>
        </div>
    </section><!-- /.content -->
</aside><!-- /.right-side -->

{% endblock %}


{% block otherdiv %}

<div class="modal fade bs-example-modal-sm" id="team-orders-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-big-max">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">订单列表 </h4>
                <div class="row" style="margin-top:10px;">
                    <div class="col-md-5 pull-right">
                        <form action="/team/update_level" method="post">
                            <div class="form-inline">
                                <div class="input-group">
                                    <span class="input-group-addon">进度:</span>
                                    <input name="level" id="team-level" value="" class="form-control">
                                    <input name="tid" id="team-level-id" type="hidden" class="form-control">
                                </div>
                                <div class="input-group">
                                    <button class="btn btn-success">更新</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>


                <div class="row" style="margin-top:10px;">
                   {% for task in tasks %}
                    <div class="col-md-1">
                        <button class="btn btn-success">{{ task.name }}</button>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="modal-body">
                
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div class="modal fade bs-example-modal-sm" id="view-order-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-big-max">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">订单列表 </h4>
            </div>
            <div class="modal-body">
                
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade bs-example-modal-sm" id="start-team-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">开始团练 </h4>
            </div>
            <form action="{{ url_for('team.start_team')}}" method="post">
                <div class="modal-body">
                  是否开始团练
                  <input type="hidden" id="tid" name="tid"/>
                </div>
                <div class="modal-footer clearfix">
                  <button type="submit" class="btn btn-primary">提交</button>
                </div>
            </form>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


{% endblock %}


{% block foot_js %}
{{ super() }}
<script type="text/javascript">
    $(function() {

        //用户table操作
        $(".modal-body").on("change",".check-all",function(event){
            if(this.checked){
                $(".check-item").iCheck('check');
            }else{
                $(".check-item").iCheck('uncheck');
            }
        });

        $(".modal-body").on("click",".view-order",function(event){
            $("#view-order-modal").modal();
             
            
        });
         
       

        $('.view-team').on("click",function(){
            selected_id = $(this).parent().siblings().find('.team-id').val();
            $.getJSON('/team/_get_team/'+selected_id,function(data){
                $('.modal-title').html(data.name+data.area_name+data.no+"组    目标:"+data.target+"级");
                $('#team-level').val(data.now_level);
                $('#team-level-id').val(data.id);
                $.get('/team/_get_team_orders/'+selected_id,function(data){
                    //alert(data);
                    $('#team-orders-modal').find('.modal-body').html(data);
                    $('#team-orders-modal').modal();
                });
            });
        });

        $('.start-team').on("click",function(){
            selected_id = $(this).parent().siblings().find('.team-id').val();
            $('#tid').val(selected_id);
            $('#start-team-modal').modal();
        });
    });
</script>
{% endblock %}